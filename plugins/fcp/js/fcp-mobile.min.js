jQuery.fn.farbtastic=function(t){return $.farbtastic(this,t),this},jQuery.farbtastic=function(t,e){var t=$(t).get(0);return t.farbtastic||(t.farbtastic=new jQuery._farbtastic(t,e))},jQuery._farbtastic=function(t,e){var o=this;$(t).css("display","none").html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker tip"></div></div><a class="fa fa-2x fa-close"></a>').appendTo(".picker");var a=$(".farbtastic",t);o.wheel=$(".wheel",t).get(0),o.radius=84,o.square=100,o.width=196,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",a).each(function(){if("none"!=this.currentStyle.backgroundImage){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),o.linkTo=function(t){return"object"==typeof o.callback&&$(o.callback).unbind("keyup",o.updateValue),o.color=null,"function"==typeof t?o.callback=t:"object"!=typeof t&&"string"!=typeof t||(o.callback=$(t),o.callback.bind("keyup",o.updateValue),o.callback.get(0).value&&o.setColor(o.callback.get(0).value)),this},o.updateValue=function(t){this.value&&this.value!=o.color&&o.setColor(this.value)},o.setColor=function(t){var e=o.unpack(t);return o.color!=t&&e&&(o.color=t,o.rgb=e,o.hsl=o.RGBToHSL(o.rgb),o.updateDisplay()),this},o.setHSL=function(t){return o.hsl=t,o.rgb=o.HSLToRGB(t),o.color=o.pack(o.rgb),o.updateDisplay(),this},o.widgetCoords=function(t){var e,a,n=t.target||t.srcElement,r=o.wheel;if(void 0!==t.offsetX){for(var u={x:t.offsetX,y:t.offsetY},s=n;s;)s.mouseX=u.x,s.mouseY=u.y,u.x+=s.offsetLeft,u.y+=s.offsetTop,s=s.offsetParent;for(var s=r,c={x:0,y:0};s;){if(void 0!==s.mouseX){e=s.mouseX-c.x,a=s.mouseY-c.y;break}c.x+=s.offsetLeft,c.y+=s.offsetTop,s=s.offsetParent}for(s=n;s;)s.mouseX=void 0,s.mouseY=void 0,s=s.offsetParent}else{var u=o.absolutePosition(r);e=(t.pageX||0*(t.clientX+$("html").get(0).scrollLeft))-u.x,a=(t.pageY||0*(t.clientY+$("html").get(0).scrollTop))-u.y}return{x:e-o.width/2,y:a-o.width/2}},o.mousedown=function(t){var e=o.widgetCoords(t);return o.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>o.square,o.mousemove(t),!1},o.touchconvert=function(t){var t=t.originalEvent.touches.item(0);return t},o.touchmove=function(t){return o.mousemove(o.touchconvert(t)),event.preventDefault(),!1},o.touchend=function(t){return $(document).unbind("touchmove",o.touchmove),$(document).unbind("touchend",o.touchend),document.dragging=!1,t.preventDefault(),!1},o.mousemove=function(t){var e=o.widgetCoords(t);if(o.circleDrag){var a=Math.atan2(e.x,-e.y)/6.28;a<0&&(a+=1),o.setHSL([a,o.hsl[1],o.hsl[2]])}else{var n=Math.max(0,Math.min(1,-e.x/o.square+.5)),r=Math.max(0,Math.min(1,-e.y/o.square+.5));o.setHSL([o.hsl[0],n,r])}return!1},o.mouseup=function(){$(document).unbind("mousemove",o.mousemove),$(document).unbind("mouseup",o.mouseup),document.dragging=!1},o.updateDisplay=function(){var t=6.28*o.hsl[0];$(".h-marker",a).css({left:Math.round(Math.sin(t)*o.radius+o.width/2)+"px",top:Math.round(-Math.cos(t)*o.radius+o.width/2)+"px"}),$(".sl-marker",a).css({left:Math.round(o.square*(.5-o.hsl[1])+o.width/2)+"px",top:Math.round(o.square*(.5-o.hsl[2])+o.width/2)+"px"}),$(".color",a).css("backgroundColor",o.pack(o.HSLToRGB([o.hsl[0],1,.5]))),"object"==typeof o.callback?($(o.callback).css({backgroundColor:o.color,color:o.hsl[2]>.5?"#000":"#fff"}),$(o.callback).each(function(){this.value&&this.value!=o.color&&(this.value=o.color)})):"function"==typeof o.callback&&o.callback.call(o,o.color)},o.absolutePosition=function(t){var e={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var a=o.absolutePosition(t.offsetParent);e.x+=a.x,e.y+=a.y}return e},o.pack=function(t){var e=Math.round(255*t[0]),o=Math.round(255*t[1]),a=Math.round(255*t[2]);return"#"+(e<16?"0":"")+e.toString(16)+(o<16?"0":"")+o.toString(16)+(a<16?"0":"")+a.toString(16)},o.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},o.HSLToRGB=function(t){var e,o,a=t[0],n=t[1],r=t[2];return o=r<=.5?r*(n+1):r+n-r*n,e=2*r-o,[this.hueToRGB(e,o,a+.33333),this.hueToRGB(e,o,a),this.hueToRGB(e,o,a-.33333)]},o.hueToRGB=function(t,e,o){return o=o<0?o+1:o>1?o-1:o,6*o<1?t+(e-t)*o*6:2*o<1?e:3*o<2?t+(e-t)*(.66666-o)*6:t},o.RGBToHSL=function(t){var e,o,a,n,r,u,s=t[0],c=t[1],i=t[2];return e=Math.min(s,Math.min(c,i)),o=Math.max(s,Math.max(c,i)),a=o-e,u=(e+o)/2,r=0,u>0&&u<1&&(r=a/(u<.5?2*u:2-2*u)),n=0,a>0&&(o==s&&o!=c&&(n+=(c-i)/a),o==c&&o!=i&&(n+=2+(i-s)/a),o==i&&o!=s&&(n+=4+(s-c)/a),n/=6),[n,r,u]},$("*",a).mousedown(function(t){document.dragging||($(document).bind("mousemove",o.mousemove).bind("mouseup",o.mouseup),document.dragging=!0),o.mousedown(t)}),$("*",a).bind("touchstart",function(t){return document.dragging||($(document).bind("touchmove",o.touchmove).bind("touchend",o.touchend),document.dragging=!0),o.mousedown(o.touchconvert(t)),t.preventDefault(),!1}),o.setColor("#D2C8B7"),e&&o.linkTo(e)},$(".fcp").click(function(){$("#fcp, .farbtastic, .fa-close").fadeIn(600),$(document.createElement("div")).attr("id","farbtasticBg").click(function(){$(this).remove(),$(".farbtastic, .fa-close").fadeOut(300)}).appendTo("body"),$("a.fa-close").click(function(){$(this).fadeOut(300),$(".farbtastic").fadeOut(300),$("#farbtasticBg").remove()})});